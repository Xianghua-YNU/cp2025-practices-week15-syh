# 项目1：双摆动力学仿真 - 实验报告

**学生姓名：** [在此处填写你的姓名]  
**学号：** [在此处填写你的学号]  
**完成日期：** [在此处填写完成日期]

## 1. 实验目的
通过数值求解双摆的运动方程，掌握非线性微分方程组的数值解法，分析其能量守恒特性，理解混沌系统的行为，并通过动画可视化复杂运动，提升计算物理建模与分析能力。

## 2. 核心算法与实现

### 2.1 运动方程的数值解法
微分方程定义：derivatives函数实现双摆的一阶方程组，利用拉格朗日方程推导的角速度导数公式，将二阶方程转换为θ₁'=ω₁、θ₂'=ω₂，并计算ω₁'和ω₂'的非线性表达式。
数值求解：调用odeint，设置rtol=1e-8、atol=1e-8确保精度，输入初始条件（θ₁=θ₂=π/2，ω₁=ω₂=0），生成 2000 个时间点的解。

### 2.2 能量计算方法
势能：V = -mgl(2cosθ₁ + cosθ₂)，动能T = ml²(ω₁² + 0.5ω₂² + ω₁ω₂cos(θ₁-θ₂))，总能量E=T+V，逐点计算。

### 2.3 关键代码片段
```python
def derivatives(y, t, L1, L2, m1, m2, g):
    theta1, omega1, theta2, omega2 = y
    den = 3 - np.cos(2*theta1-2*theta2)
    dω1 = (-omega1²*np.sin(2θ1-2θ2) - 2ω2²*np.sin(θ1-θ2) - (g/L1)*(np.sin(θ1-2θ2)+3np.sinθ1)) / den
    dω2 = (4ω1²*np.sin(θ1-θ2) + ω2²*np.sin(2θ1-2θ2) + 2(g/L1)*(np.sin(2θ1-θ2)-np.sinθ2)) / den
    return [omega1, dω1, omega2, dω2]

def calculate_energy(sol_arr, L, m, g):
    θ1, ω1, θ2, ω2 = sol_arr.T
    V = -m*g*L*(2np.cosθ1 + np.cosθ2)
    T = m*L²*(ω1² + 0.5ω2² + ω1ω2np.cos(θ1-θ2))
    return T+V
```

## 3. 实验结果与分析

### 3.1 能量守恒分析
（粘贴你生成的“能量 vs. 时间”图像。分析图像，讨论能量是否守恒。如果存在数值误差导致的不守恒，量化这个误差（例如，总能量的变化范围或标准差），并讨论你是如何通过调整 `odeint` 的参数（如 `rtol`, `atol`）或增加 `t_points` 来尝试满足题目 $10^{-5}$ 焦耳的精度要求的。）

**(在此处插入能量随时间变化的图像)**
![4-1](https://github.com/user-attachments/assets/72ad6aa2-f7c7-4a4d-b1f9-07b3af797de1)
图像分析：能量随时间波动（如图所示），最大变化约2.21e-5 J，略超1e-5 J目标。通过优化odeint参数（如rtol=1e-8）和增加时间点数（2000 点），误差接近目标，验证了数值方法的稳定性。

### 3.2 双摆运动轨迹 (可选，如果未做动画则省略)
（如果你完成了动画部分，可以简要描述双摆的典型运动特征，例如混沌行为、对初始条件的敏感性等。可以附上一张动画中的截图。）

**(在此处插入动画截图，如果适用)**
![4-2](https://github.com/user-attachments/assets/c4098a1e-3fbc-4819-8a0a-0ed0cd262de9)
混沌特性：动画显示双摆运动对初始条件敏感，微小差异导致轨迹分叉（如初始角度微调后，摆臂运动迅速偏离原路径），体现混沌系统的不可预测性，符合 “蝴蝶效应”。

## 4. 问题与收获

### 4.1 遇到的主要问题
（列出1-2个在实现过程中遇到的主要困难或挑战，例如：理解微分方程组、调试 `odeint` 参数、实现动画等。）

公式推导：理解拉格朗日方程的化简步骤，尤其是三角函数的符号和系数，需反复核对。

能量调试：初期因公式错误导致能量不守恒，通过对比理论公式修正代码。

### 4.2 解决方法与学习心得
（简述你是如何解决上述问题的。总结通过本次实验学到的主要知识点、技能或对计算物理的理解，例如：数值求解ODE的经验、混沌系统特性、能量分析的重要性等。）

分步验证：先测试微分方程，再验证能量计算，逐步排查错误。

精度优化：通过调整odeint参数，平衡计算效率与能量守恒，提升数值模拟的可靠性。

### 4.3 主要收获
掌握非线性 ODE 的数值求解与能量分析方法。
深入理解混沌系统的特性（敏感依赖、能量守恒的数值挑战）。
学会利用动画可视化复杂物理过程，增强数据解读能力。

## 5. 思考题（可选）

1.  如果双摆的两个摆臂长度不同（ $L_1 \neq L_2$）或两个摆锤质量不同（ $m_1 \neq m_2$），运动方程会如何变化？你将如何修改你的 `derivatives` 函数来适应这种情况？（提示：需要回顾拉格朗日方程的推导或查找更通用的双摆方程。）

运动方程变化
当 
$$L_1 \neq L_2\$$
或 
$$m_1 \neq m_2\$$
时，双摆的动能和势能表达式需要修正：

势能：
$$V = -m_1 g L_1 \cos\theta_1 - m_2 g (L_1 \cos\theta_1 + L_2 \cos\theta_2)$$

动能：
$$T = \frac{1}{2} m_1 (L_1 \dot{\theta}_1)^2 + \frac{1}{2} m_2 \left[ L_1^2 \dot{\theta}_1^2 + L_2^2 \dot{\theta}_2^2 + 2 L_1 L_2 \dot{\theta}_1 \dot{\theta}_2 \cos(\theta_1 - \theta_2) \right]$$

拉格朗日方程推导：

通过欧拉 - 拉格朗日方程 
$$\frac{d}{dt}\left(\frac{\partial L}{\partial \dot{\theta}_i}\right) = \frac{\partial L}{\partial \theta_i}$$
，最终得到角速度导数：

$$\dot{\omega}_1 = \frac{-m_2 L_2 \omega_2^2 \sin(\theta_1 - \theta_2) - (m_1 + m_2) g \sin\theta_1 - m_2 L_1 \omega_1^2 \sin(2\theta_1 - 2\theta_2) / 2}{L_1 (m_1 + m_2 \sin^2(\theta_1 - \theta_2))}$$

$$\dot{\omega}_2 = \frac{(m_1 + m_2)(L_1 \omega_1^2 \sin(\theta_1 - \theta_2) + g \sin\theta_2) + m_2 L_2 \omega_2^2 \sin(2\theta_1 - 2\theta_2) / 2}{L_2 (m_1 + m_2 \sin^2(\theta_1 - \theta_2))}$$

derivatives 函数修改

需调整参数接收和公式实现：
```python
def derivatives(y, t, L1, L2, m1, m2, g):
    theta1, omega1, theta2, omega2 = y
    
    # 分母项
    denominator = m1 + m2 * np.sin(theta1 - theta2)**2
    
    # ω₁' 的分子
    domega1_num = -m2 * L2 * omega2**2 * np.sin(theta1 - theta2) \
                  - (m1 + m2) * g * np.sin(theta1) \
                  - m2 * L1 * omega1**2 * np.sin(2*theta1 - 2*theta2) / 2
    
    # ω₂' 的分子
    domega2_num = (m1 + m2) * (L1 * omega1**2 * np.sin(theta1 - theta2) + g * np.sin(theta2)) \
                  + m2 * L2 * omega2**2 * np.sin(2*theta1 - 2*theta2) / 2
    
    # 计算导数
    domega1 = domega1_num / (L1 * denominator)
    domega2 = domega2_num / (L2 * denominator)
    
    return [omega1, domega1, omega2, domega2]
```

2.  双摆的运动对初始条件高度敏感。尝试稍微改变初始角度（例如，将 $\theta_1$ 或 $\theta_2$ 改变 $0.001$ 弧度），重新运行仿真，并比较两个轨迹（例如，绘制 $\theta_1(t)$ 的对比图）。你观察到了什么现象？这与混沌理论有什么关系？

实验现象

通过微小改变初始角度（如 
$$\theta_1\$$
增加0.001)弧度），对比两条轨迹的 
$$\theta_1(t)\$$
曲线：

短期相似性：初始阶段（约前 5 秒），两条轨迹几乎重合。

指数发散：约 10 秒后，轨迹开始明显分离；20 秒后完全不同，呈现随机性。

能量守恒：尽管轨迹差异巨大，两条轨迹的总能量均保持守恒（波动范围相同）。

与混沌理论的关系

敏感依赖：初始条件的微小差异导致系统演化路径指数级分离，符合混沌系统的核心特征。

确定性与不可预测性：系统由确定性方程描述，但长期行为不可预测，体现 “确定性混沌” 的矛盾特性。

物理意义：双摆的混沌行为表明，即使简单的物理系统也可能产生复杂到无法预测的运动，强调了精确测量初始条件的重要性。

可视化验证代码

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.integrate import odeint

# 设置中文显示
plt.rcParams["font.family"] = ["SimHei"]
plt.rcParams['axes.unicode_minus'] = False  # 解决负号显示问题

# 双摆导数函数（非对称版本）
def derivatives(y, t, L1, L2, m1, m2, g):
    theta1, omega1, theta2, omega2 = y
    
    # 分母项
    denominator = m1 + m2 * np.sin(theta1 - theta2)**2
    
    # ω₁' 的分子
    domega1_num = -m2 * L2 * omega2**2 * np.sin(theta1 - theta2) \
                  - (m1 + m2) * g * np.sin(theta1) \
                  - m2 * L1 * omega1**2 * np.sin(2*theta1 - 2*theta2) / 2
    
    # ω₂' 的分子
    domega2_num = (m1 + m2) * (L1 * omega1**2 * np.sin(theta1 - theta2) + g * np.sin(theta2)) \
                  + m2 * L2 * omega2**2 * np.sin(2*theta1 - 2*theta2) / 2
    
    # 计算导数
    domega1 = domega1_num / (L1 * denominator)
    domega2 = domega2_num / (L2 * denominator)
    
    return [omega1, domega1, omega2, domega2]

# 能量计算函数
def calculate_energy(sol, L1, L2, m1, m2, g):
    theta1, omega1, theta2, omega2 = sol.T
    # 势能
    V = -m1 * g * L1 * np.cos(theta1) - m2 * g * (L1 * np.cos(theta1) + L2 * np.cos(theta2))
    # 动能
    T = 0.5 * m1 * (L1 * omega1)**2 + 0.5 * m2 * (
        (L1 * omega1)**2 + (L2 * omega2)**2 + 2 * L1 * L2 * omega1 * omega2 * np.cos(theta1 - theta2)
    )
    return T + V

# 仿真参数
L1, L2 = 0.4, 0.4  # 摆长 (米)
m1, m2 = 1.0, 1.0  # 质量 (千克)
g = 9.81           # 重力加速度 (米/秒²)
t_span = (0, 100)  # 时间范围 (秒)
t_points = 2000    # 时间点数量

# 生成时间数组
t = np.linspace(t_span[0], t_span[1], t_points)

# 定义两个初始条件（微小差异）
ic1 = {'theta1': np.pi/2, 'omega1': 0, 'theta2': np.pi/2, 'omega2': 0}  # 基准条件
ic2 = {'theta1': np.pi/2 + 0.001, 'omega1': 0, 'theta2': np.pi/2, 'omega2': 0}  # 微扰条件

# 求解ODE
sol1 = odeint(derivatives, [ic1[k] for k in ['theta1', 'omega1', 'theta2', 'omega2']], 
              t, args=(L1, L2, m1, m2, g), rtol=1e-8, atol=1e-8)
sol2 = odeint(derivatives, [ic2[k] for k in ['theta1', 'omega1', 'theta2', 'omega2']], 
              t, args=(L1, L2, m1, m2, g), rtol=1e-8, atol=1e-8)

# 计算能量
energy1 = calculate_energy(sol1, L1, L2, m1, m2, g)
energy2 = calculate_energy(sol2, L1, L2, m1, m2, g)

# 计算能量变化
initial_energy = energy1[0]
energy_change1 = np.max(energy1) - np.min(energy1)
energy_change2 = np.max(energy2) - np.min(energy2)

# 绘制轨迹对比图
plt.figure(figsize=(12, 8))

# 图1：θ₁(t) 对比
plt.subplot(2, 1, 1)
plt.plot(t, sol1[:, 0], 'b-', linewidth=1.5, label='基准条件 (θ₁=π/2)')
plt.plot(t, sol2[:, 0], 'r--', linewidth=1.5, label='微扰条件 (θ₁=π/2+0.001)')
plt.xlabel('时间 (秒)')
plt.ylabel('θ₁ (弧度)')
plt.title('双摆轨迹对初始条件的敏感性')
plt.legend()
plt.grid(True)

# 图2：能量随时间变化
plt.subplot(2, 1, 2)
plt.plot(t, energy1 - initial_energy, 'g-', linewidth=1.5, label=f'条件1 (变化: {energy_change1:.2e} J)')
plt.plot(t, energy2 - initial_energy, 'm-', linewidth=1.5, label=f'条件2 (变化: {energy_change2:.2e} J)')
plt.axhline(y=0, color='k', linestyle='--', alpha=0.5)
plt.xlabel('时间 (秒)')
plt.ylabel('能量偏差 (J)')
plt.title('系统总能量随时间的变化')
plt.legend()
plt.grid(True)

plt.tight_layout()
plt.show()
```

![4-3](https://github.com/user-attachments/assets/f7ed00ee-e1c9-4867-8f40-0ac639867515)
通过此图可直观观察到轨迹从 “几乎重合” 到 “完全分离” 的过程，验证混沌系统的特性。

---

_报告长度建议：500-1000字（不含代码和图片），重点关注对物理模型、数值方法和结果分析的理解与反思。_
